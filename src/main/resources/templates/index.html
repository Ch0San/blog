<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ko">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ë¸”ë¡œê·¸ ë©”ì¸</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
  <!-- ê³µí†µ í—¤ë” import -->
  <div th:replace="~{fragments/header :: header('home')}"></div>

  <!-- í—¤ë” ë°”ë¡œ ì•„ë˜ íˆì–´ë¡œ ì´ë¯¸ì§€ -->
  <section class="index_image container">
    <div style="position:relative">
      <img th:src="@{${heroImageUrl}}" alt="ë¸”ë¡œê·¸ ë©”ì¸ ì´ë¯¸ì§€" style="width:100%;height:auto" />
      <!-- ê´€ë¦¬ìë§Œ: íˆì–´ë¡œ ì´ë¯¸ì§€ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™ ë²„íŠ¼ (ì¢Œì¸¡ ìƒë‹¨) -->
      <div sec:authorize="hasRole('ADMIN')" class="hero-image-action">
        <a th:href="@{/admin/site/hero-image}">ì´ë¯¸ì§€ ìˆ˜ì •</a>
      </div>
      <div class="visitor-counter">
        <span>Today: <strong th:text="${todayVisitors}">0</strong></span>
        <span class="separator">|</span>
        <span>Total: <strong th:text="${totalVisitors}">0</strong></span>
      </div>
    </div>
  </section>
  <main class="container">
    <div class="layout">
      <aside class="sidebar">
        <div class="profile card">
          <p>ê°œë°œì ì—¬í–‰ ì¼ìƒ ê³µìœ </p>
          <h3 sec:authorize="isAuthenticated()">
            <span th:text="${currentMember != null ? currentMember.nickname : ''}">ì‚¬ìš©ì</span>ë‹˜ ë°˜ê°‘ìŠµë‹ˆë‹¤ :D
          </h3>
          <h3 sec:authorize="!isAuthenticated()">ë°˜ê°‘ìŠµë‹ˆë‹¤ :D</h3>

          <div sec:authorize="!isAuthenticated()" style="margin-top:16px;display:flex;gap:8px">
            <a href="/member/signup" class="btn btn-primary"
              style="flex:1;text-align:center;padding:8px 16px;font-size:13px">íšŒì›ê°€ì…</a>
            <a href="/member/signin" class="btn btn-secondary"
              style="flex:1;text-align:center;padding:8px 16px;font-size:13px">ë¡œê·¸ì¸</a>
          </div>
          <div sec:authorize="isAuthenticated()" style="margin-top:16px;display:flex;gap:8px">
            <a href="/member/update" class="btn btn-primary"
              style="flex:1;text-align:center;padding:10px 16px;font-size:14px;display:block">ì •ë³´ìˆ˜ì •</a>
            <a sec:authorize="hasRole('ADMIN')" href="/member/list" class="btn btn-secondary"
              style="flex:1;text-align:center;padding:10px 16px;font-size:14px;display:block">íšŒì›ëª©ë¡</a>
          </div>
        </div>

        <div class="widgets" style="margin-top:12px">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
              <strong style="color:var(--text)">ì†Œê°œ</strong>
              <a sec:authorize="hasRole('ADMIN')" href="/member/introduction-update"
                style="background:var(--accent);color:#fff;padding:4px 12px;border-radius:4px;text-decoration:none;font-size:12px;font-weight:500">
                ìˆ˜ì •
              </a>
            </div>
            <p style="margin:12px 0 0;color:var(--muted);font-size:14px;line-height:1.6;white-space:pre-line"
              th:text="${introduction != null ? introduction : 'ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹\nì´ˆë³´ ê°œë°œìì…ë‹ˆë‹¤.\nê°œë°œ ê³µë¶€í•˜ë©´ì„œ ë°°ìš´ ë‚´ìš©ê³¼\nì¼ìƒ, ì—¬í–‰ ì´ì•¼ê¸°ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.'}">
              ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹<br />
              ì´ˆë³´ ê°œë°œìì…ë‹ˆë‹¤.<br />
              ê°œë°œ ê³µë¶€í•˜ë©´ì„œ ë°°ìš´ ë‚´ìš©ê³¼<br />
              ì¼ìƒ, ì—¬í–‰ ì´ì•¼ê¸°ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.
            </p>
          </div>

          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
              <strong style="color:var(--text)">íƒœê·¸</strong>
              <a sec:authorize="hasRole('ADMIN')" href="/member/tag-update"
                style="background:var(--accent);color:#fff;padding:4px 12px;border-radius:4px;text-decoration:none;font-size:12px;font-weight:500">
                ìˆ˜ì •
              </a>
            </div>
            <div style="display:flex;flex-wrap:wrap;gap:8px">
              <span th:each="tag : ${#strings.arraySplit(tags != null ? tags : 'Java,Spring,MyBatis', ',')}"
                th:if="${!#strings.isEmpty(#strings.trim(tag))}"
                style="background:#e6f7ed;padding:6px 12px;border-radius:16px;color:var(--accent);font-size:13px;cursor:pointer">
                <span th:text="'#' + ${#strings.trim(tag)}">#Java</span>
              </span>
            </div>
          </div>

          <!-- ê³µì§€ì‚¬í•­ ì¹´ë“œ: íƒœê·¸ ì¹´ë“œ ë°”ë¡œ ì•„ë˜, ë‹¤ë¥¸ ì„¹ì…˜ ì¹¨ë²” ë°©ì§€ ìœ„í•´ ë…ë¦½ ì¹´ë“œë¡œ êµ¬ì„± -->
          <div class="card notice-card">
            <div class="notice-card-header">
              <strong style="color:var(--text)">ê³µì§€ì‚¬í•­</strong>
              <div class="notice-actions">
                <a href="/notice" class="notice-link">ì „ì²´ë³´ê¸°</a>
                <a sec:authorize="hasRole('ADMIN')" href="/notice/write" class="notice-write">ì‘ì„±</a>
              </div>
            </div>
            <ul class="notice-list">
              <li class="notice-item" th:each="n : ${recentNotices}">
                <span class="notice-dot"></span>
                <a th:href="@{'/notice/' + ${n.id}}" th:text="${n.title}" class="notice-title">ê³µì§€ ì œëª©</a>
                <span th:text="${#temporals.format(n.createdAt, 'MM.dd')}" class="notice-date">10.29</span>
              </li>
              <li th:if="${#lists.isEmpty(recentNotices)}" class="notice-empty">
                ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.
              </li>
            </ul>
          </div>
        </div>
      </aside>

      <section class="main">
        <!-- ìµœì‹  ê¸€ ì„¹ì…˜ -->
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px">
          <h2 style="margin:0;color:var(--text)">ìµœì‹  ê¸€</h2>
          <div style="color:var(--muted);font-size:14px">ì „ì²´ <span th:text="${totalPosts}">0</span>ê°œ</div>
        </div>

        <div class="post-list">
          <article class="post" th:each="post : ${recentPosts}" th:attr="data-href=@{'/posts/' + ${post.id}}"
            role="link" tabindex="0" style="cursor:pointer">
            <!-- ì¸ë„¤ì¼ ì´ë¯¸ì§€ ë˜ëŠ” ê¸°ë³¸ ì´ë¯¸ì§€ -->
            <div class="post-thumbnail"
              style="width:100%;height:200px;border-radius:8px;overflow:hidden;margin-bottom:12px;background:#f5f5f5">
              <img th:if="${post.thumbnailUrl != null && !#strings.isEmpty(post.thumbnailUrl)}"
                th:src="${post.thumbnailUrl}" alt="ì¸ë„¤ì¼" style="width:100%;height:100%;object-fit:cover"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <div th:unless="${post.thumbnailUrl != null && !#strings.isEmpty(post.thumbnailUrl)}"
                style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;font-size:18px;font-weight:500"
                th:text="${post.category != null ? post.category : 'ì¼ë°˜'}">
                ì¹´í…Œê³ ë¦¬
              </div>
            </div>
            <h4>
              <a th:href="@{'/posts/' + ${post.id}}" th:text="${post.title}"
                style="color:var(--text);text-decoration:none">ì œëª©</a>
            </h4>
            <p style="margin:0;color:var(--muted);font-size:14px;line-height:1.5"
              th:text="${#strings.length(post.content) > 80 ? #strings.substring(post.content, 0, 80) + '...' : post.content}">
              ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°
            </p>
            <div class="meta">
              <span th:text="${post.author}">ì‘ì„±ì</span>
              <span class="dot"></span>
              <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd')}">ë‚ ì§œ</span>
              <span class="dot"></span>
              <span>ì½ìŒ <span th:text="${post.viewCount}">0</span></span>
            </div>
          </article>

          <!-- ê²Œì‹œê¸€ì´ ì—†ì„ ë•Œ -->
          <div th:if="${#lists.isEmpty(recentPosts)}" style="text-align:center;padding:60px 20px;color:var(--muted)">
            <p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </div>

        <!-- ì¸ê¸° ê¸€ ì„¹ì…˜ -->
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;margin-top:50px">
          <h2 style="margin:0;color:var(--text)">ì¸ê¸° ê¸€</h2>
          <div style="color:var(--muted);font-size:14px">ì¡°íšŒìˆ˜ ìˆœ</div>
        </div>

        <div class="post-list">
          <article class="post" th:each="post : ${popularPosts}" th:attr="data-href=@{'/posts/' + ${post.id}}"
            role="link" tabindex="0" style="cursor:pointer">
            <!-- ì¸ë„¤ì¼ ì´ë¯¸ì§€ ë˜ëŠ” ê¸°ë³¸ ì´ë¯¸ì§€ -->
            <div class="post-thumbnail"
              style="width:100%;height:200px;border-radius:8px;overflow:hidden;margin-bottom:12px;background:#f5f5f5">
              <img th:if="${post.thumbnailUrl != null && !#strings.isEmpty(post.thumbnailUrl)}"
                th:src="${post.thumbnailUrl}" alt="ì¸ë„¤ì¼" style="width:100%;height:100%;object-fit:cover"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <div th:unless="${post.thumbnailUrl != null && !#strings.isEmpty(post.thumbnailUrl)}"
                style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;font-size:18px;font-weight:500"
                th:text="${post.category != null ? post.category : 'ì¼ë°˜'}">
                ì¹´í…Œê³ ë¦¬
              </div>
            </div>
            <h4>
              <a th:href="@{'/posts/' + ${post.id}}" th:text="${post.title}"
                style="color:var(--text);text-decoration:none">ì œëª©</a>
            </h4>
            <p style="margin:0;color:var(--muted);font-size:14px;line-height:1.5"
              th:text="${#strings.length(post.content) > 80 ? #strings.substring(post.content, 0, 80) + '...' : post.content}">
              ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°
            </p>
            <div class="meta">
              <span th:text="${post.author}">ì‘ì„±ì</span>
              <span class="dot"></span>
              <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd')}">ë‚ ì§œ</span>
              <span class="dot"></span>
              <span>ì½ìŒ <span th:text="${post.viewCount}">0</span></span>
            </div>
          </article>

          <!-- ê²Œì‹œê¸€ì´ ì—†ì„ ë•Œ -->
          <div th:if="${#lists.isEmpty(popularPosts)}" style="text-align:center;padding:60px 20px;color:var(--muted)">
            <p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </div>

        <div th:replace="~{fragments/footer :: footer}"></div>
      </section>
    </div>
  </main>
  <script>
    // ì¹´ë“œ ì „ì²´ í´ë¦­/Enter/Spaceë¡œ ìƒì„¸ë¡œ ì´ë™
    document.addEventListener('click', function (e) {
      const card = e.target.closest('article.post[data-href]');
      if (!card) return;
      if (e.target.closest('a')) return; // ë‚´ë¶€ ë§í¬ í´ë¦­ì€ ê·¸ëŒ€ë¡œ
      const href = card.getAttribute('data-href');
      if (href) window.location.href = href;
    });
    document.addEventListener('keydown', function (e) {
      if (e.key !== 'Enter' && e.key !== ' ') return;
      const el = document.activeElement;
      if (!el || !el.matches('article.post[data-href]')) return;
      e.preventDefault();
      const href = el.getAttribute('data-href');
      if (href) window.location.href = href;
    });
  </script>
</body>

</html>