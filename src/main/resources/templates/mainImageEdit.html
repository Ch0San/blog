<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ko">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>메인 이미지 수정</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
  <div th:replace="~{fragments/header :: header('home')}"></div>

  <main class="container" style="max-width:900px">
    <div class="card" style="padding:20px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <h2 style="margin:0">메인 이미지 수정</h2>
        <a th:href="@{/}" class="btn btn-secondary" style="text-decoration:none">메인으로</a>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start">
        <div>
          <strong style="display:block;margin-bottom:8px">현재 이미지</strong>
          <div style="border:1px solid #e6e9ee;border-radius:8px;overflow:hidden;background:#f9fafb">
            <img th:src="@{${heroImageUrl}}" alt="현재 메인 이미지" style="width:100%;height:auto;display:block">
          </div>
        </div>
        <div>
          <strong style="display:block;margin-bottom:8px">새 이미지 업로드</strong>
          <form th:action="@{/admin/site/hero-image}" method="post" enctype="multipart/form-data" class="write-form"
            style="box-shadow:none;padding:16px">
            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <div class="form-group" style="margin:0 0 12px 0">
              <input type="file" name="file" accept="image/*" required>
              <div style="color:#6b7280;font-size:12px;margin-top:6px">권장: 1200x400 이상, JPG/PNG/WEBP</div>
            </div>
            <div style="display:flex;gap:8px;justify-content:flex-end">
              <a th:href="@{/}" class="btn btn-secondary" style="text-decoration:none">취소</a>
              <button type="submit" class="btn btn-primary">업로드</button>
            </div>
            <div th:if="${param.updated}" style="margin-top:10px;color:#16a34a;font-size:13px">이미지가 업데이트되었습니다.</div>
            <div th:if="${param.error}" style="margin-top:10px;color:#dc2626;font-size:13px">업로드에 실패했습니다. 파일 형식 또는 용량을
              확인하세요.</div>
          </form>
        </div>
      </div>
    </div>
    <div class="card" style="padding:20px;margin-top:16px">
      <strong style="display:block;margin-bottom:12px">과거 이미지</strong>
      <div th:if="${heroImageList == null or #lists.isEmpty(heroImageList)}" style="color:#6b7280;font-size:14px">저장된 과거
        이미지가 없습니다.</div>
      <div th:if="${heroImageList != null and !#lists.isEmpty(heroImageList)}"
        style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px">
        <div th:each="imgUrl : ${heroImageList}"
          style="position:relative;border:1px solid #e6e9ee;border-radius:8px;overflow:hidden;background:#f9fafb">
          <img th:src="@{${imgUrl}}" alt="과거 메인 이미지" style="width:100%;height:120px;object-fit:cover;display:block">
          <div style="position:absolute;right:8px;bottom:8px;display:flex;gap:6px">
            <span th:if="${heroImageUrl == imgUrl}"
              style="background:#111827;color:#fff;font-size:11px;padding:3px 6px;border-radius:4px">현재 사용중</span>
            <form th:action="@{/admin/site/hero-image/delete}" method="post"
              onsubmit="return confirm('해당 이미지를 삭제하시겠습니까?');">
              <input type="hidden" name="url" th:value="${imgUrl}">
              <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}" />
              <button type="submit" class="btn btn-danger" style="padding:6px 10px;font-size:12px">삭제</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>
</body>

</html>