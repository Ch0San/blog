<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>게시글 목록</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>

<body>
    <!-- 공통 헤더 import -->
    <div th:replace="~{fragments/header :: header('posts')}"></div>

    <main class="container" style="padding-top:28px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
            <div style="display:flex;align-items:center;gap:20px">
                <h1 style="margin:0;color:var(--text)">포스트</h1>
                <!-- 카테고리 탭 -->
                <div class="category-tabs">
                    <a th:href="@{/posts}" th:classappend="${currentCategory == null ? 'active' : ''}"
                        class="category-tab">
                        전체
                    </a>
                    <a th:href="@{/posts(category='여행')}" th:classappend="${currentCategory == '여행' ? 'active' : ''}"
                        class="category-tab">
                        여행
                    </a>
                    <a th:href="@{/posts(category='맛집')}" th:classappend="${currentCategory == '맛집' ? 'active' : ''}"
                        class="category-tab">
                        맛집
                    </a>
                    <a th:href="@{/posts(category='기술')}" th:classappend="${currentCategory == '기술' ? 'active' : ''}"
                        class="category-tab">
                        기술
                    </a>
                    <a th:href="@{/posts(category='일상')}" th:classappend="${currentCategory == '일상' ? 'active' : ''}"
                        class="category-tab">
                        일상
                    </a>
                </div>
            </div>
            <a sec:authorize="hasRole('ADMIN')" href="/posts/write"
                style="background:var(--accent);color:#fff;padding:10px 20px;border-radius:6px;text-decoration:none;font-weight:500;transition:opacity 0.2s"
                onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">글쓰기</a>
        </div>

        <div th:if="${#lists.isEmpty(posts)}" class="empty-state">
            <p style="font-size:1.1em">게시글이 없습니다.</p>
        </div>

        <div th:each="post : ${posts}" class="post-item" style="display:flex;gap:20px;align-items:flex-start">
            <div style="flex:1">
                <div class="title"><a th:href="@{'/posts/' + ${post.id}}" th:text="${post.title}">제목</a></div>
                <div class="meta"><span th:text="${post.author}">author</span> · <span
                        th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">date</span></div>
                <div class="excerpt">
                    <span
                        th:text="${#strings.length(post.content) > 150 ? #strings.substring(post.content, 0, 150) + '...' : post.content}">내용
                        미리보기</span>
                </div>
            </div>
            <!-- 썸네일 이미지 -->
            <div style="width:180px;height:120px;flex-shrink:0;border-radius:8px;overflow:hidden;background:#f5f5f5">
                <img th:if="${post.thumbnailUrl != null && !#strings.isEmpty(post.thumbnailUrl)}"
                    th:src="${post.thumbnailUrl}" alt="썸네일" style="width:100%;height:100%;object-fit:cover"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div th:unless="${post.thumbnailUrl != null && !#strings.isEmpty(post.thumbnailUrl)}"
                    style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;font-size:14px;font-weight:500"
                    th:text="${post.category != null ? post.category : '포스트'}">
                    포스트
                </div>
            </div>
        </div>

        <div class="pagination" th:if="${page.totalPages} > 1">
            <a th:if="${!page.first}"
                th:href="${searchField} != null ? @{/posts/search(page=${page.number - 1}, field=${searchField}, q=${searchQuery})} : @{/posts(page=${page.number - 1}, category=${currentCategory})}">&laquo;
                이전</a>
            <span th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}">
                <a th:if="${i != page.number}"
                    th:href="${searchField} != null ? @{/posts/search(page=${i}, field=${searchField}, q=${searchQuery})} : @{/posts(page=${i}, category=${currentCategory})}"
                    th:text="${i + 1}">1</a>
                <span th:if="${i == page.number}" class="current" th:text="${i + 1}">1</span>
            </span>
            <a th:if="${!page.last}"
                th:href="${searchField} != null ? @{/posts/search(page=${page.number + 1}, field=${searchField}, q=${searchQuery})} : @{/posts(page=${page.number + 1}, category=${currentCategory})}">다음
                &raquo;</a>
        </div>

    </main>
    <div th:replace="~{fragments/footer :: footer}"></div>
</body>

</html>